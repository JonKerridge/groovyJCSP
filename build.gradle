group 'groovyJCSP'
version '2.4.12-1.1.0'

apply plugin: 'groovy'
apply plugin: 'java'

sourceCompatibility = 1.8
def jcspJarFile = null
def home = null
home = System.getenv('JCSP_HOME')
if (home == null){
  throw new GradleException('JCSP_HOME environment variable is not defined')
}
//println "JCSP home folder is $home"
def currentLen = 100 // assume length of file name is less than 100 characters
if ( new File(home).isDirectory()){
  new File(home).eachFile { File f ->
    def fName = f.name
    //println "processing $fName"
    if (fName =~ '^jcsp-.+jar$'){
      def len = fName.length()
      if (len <= currentLen) { // look for jar file with shortest name
        jcspJarFile = f.name
        currentLen = len
      }
    }
  }
}
if ( jcspJarFile == null){
  throw new GradleException('No jcsp library was found in $home')
}
println "using JCSP library $jcspJarFile"
def libDir = "${getBuildDir()}/libs"
def buildJarFile = "$libDir/${project.name}-${version}.jar"


task makeJar ( dependsOn: build){
  doLast {
    copy {
      from "$buildJarFile"
      into "$home"
    }
    println "Copied $buildJarFile into $home"
  }
}


repositories {
  mavenCentral()
  jcenter()
}
// bintray location https://dl.bintray.com/jonkerridge/jcsp

dependencies {
  compile 'org.codehaus.groovy:groovy:2.4.12'
  compile fileTree(dir: "$home", include: ["$jcspJarFile"])
  testCompile 'org.codehaus.groovy:groovy:2.4.12'
  testCompile group: 'junit', name: 'junit', version: '4.12'
  testCompile fileTree(dir: "$home", include: ["$jcspJarFile"])
}
